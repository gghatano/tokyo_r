打撃能力の比較: XRみたいな指標を計算する
====

## はじめに 手元でセイバーメトリクス

イチローと松井、どちらが凄いのかを考えます。

ヒットを量産するイチロー。長打力の松井。打者のタイプが異なります。どうやって比べましょうか。

セイバーメトリクスでは、打撃総合能力を表す指標がいくつか提案されています。

今回は[XR](http://baseballconcrete.web.fc2.com/glossary.html#xr)という指標に注目します。

表式は以下の通り(長いので少し省略があります)。

$$
\begin{aligned}
\text{XR} & = 0.50\times \text{単打数} + 0.72 \times \text{二塁打数} + 1.04 \times {三塁打数} \\
          & + 1.44 \times \text{本塁打数} + 0.34 \times \text{四死球数} +  0.25 \times \text{敬遠数} \\ 
          & + 0.18 \times \text{盗塁数} - 0.098 \times{三振数} + \ldots 
\end{aligned}
$$

XRは、選手が生み出した総得点を算出するための指標です。

とはいったものの、各打席結果に、価値の重みをつけて線型和をとっているだけです。

本塁打は1本あたり1.44点生み出す、という気持ちで作られています。

なるほど。

...この重み係数はどこから来たのでしょうか。

## 線形回帰でヒットとホームランの価値を計算

2005年のメジャーリーグの試合結果データを利用して、重み係数を作成します。

チーム得点 ~ 単打数 + 二塁打数 + 三塁打数 + 本塁打数 + 四球数 + 盗塁数 + 盗塁失敗数 + 三振数 + 凡打数 

という線型モデルを立てて、係数を推定します。

これにより、各イベントの生み出す得点数を調べます。

利用するデータは2005年のメジャーリーグ全試合全打席結果のデータです。

イチローも松井も、まだ元気だった頃です。

### 計算の準備

まずはパッケージとデータの準備をします。


```r
library(dplyr)
library(data.table)
library(tidyr)

## devtools::install_github("gghatano/retrosheet")
library(retrosheet)
## データの用意。
dat = retrosheet(2005) %>% as.data.frame
## 内容確認 データのサイズ
dat %>% dim

## 内容確認 データの項目
dat %>% names
```















